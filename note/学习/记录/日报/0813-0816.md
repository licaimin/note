## 0813-0816

# 项目

- ### 任务 文件上传模块(进度80%)

  1.完成node端大，小文件的上传，上传进度同步（完成一半，有bug），上传暂停，失败重试 ，上传过程中取消， 删除

  2.完成web端上传大小文件，辅助功能还没完成

- ## 学习

  1.学习了如果实现一个npm模块包，要怎么将相关API和事件信息注册跟返回，参考了node的EventEmitter

  2.总是想着先实现一个再考虑之后，导致在实现暂停功能时，反反复复代码写了3种，一开始只写了上传，没有考虑一次最多只能发一定量（假设是5个）的请求，不然如果多用户，这个并发量对服务器压力很大，接着实现了一次接连发5个请求后，却是5个请求成功返回后再重新发5个请求，很明显，这样的处理也是错的，因为一次可以接连发5个请求，一个返回后，不就可以补上去新的请求了，保持持续这个请求队列是满的，重点是导师跟我说的思路，维护一个请求队列

  3.学习了web worker，之前只是理论看了下，这次终于实践了一回，但是因为Worker构造函数接收的参数是worker文件的路径,同时worker.js是一个独立的文件，因此不能直接import其他模块，需要通过webpack编译为一个独立的文件，所以用到了worker-loader

- ## 待解决的问题

  1. 通过fs.createReadStream获取的数据流直接上传后台，通过crypto加密后，后端返回md5 verify fail

     > 1)http request 是个文件流，body 直接是buffer
     >
     > 2)将二进制文件读取为blob类型的数据,再发给后台，但是buffer 应该也行的，http请求就是一个流，符合规范就行了，这个`有待解决`

  2. 发现当离线时，即使请求失败，事件ajax的upload的process的进度也会继续到变为100，得看axios有没有关于这方面的处理

  3. 上传文件的如果是上传超过50M的文件夹压缩包时，上传成功，但是下载却解压失败，待后端解决

  4. 得跟后端讨论下上传文件成功后能不能返回一个全部上传成功确定的信息

     

# 下周工作计划

1. 解决以上提到的问题
2. 完成 web端处理文件上传的相关功能
3. 封装npm 和 API文档