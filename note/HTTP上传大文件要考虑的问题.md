## [HTTP上传大文件要考虑的问题](https://www.cnblogs.com/doit8791/p/9108639.html)

1、大文件上传服务器内存占用

一般WEB开发框架如SpringMVC，在基于Web容器如Tomcat处理HTTP请求时，都倾向于采用职责链流水线式的处理机制。HTTP请求被封装为一个可解析对象放在内存里依次往下传。如果请求不光是正常文本，还带着上传文件，则需要考虑Web容器限制当个请求的大小。如很多WEB容器默认一个请求最多分配20M的服务器内存，如果要在一次请求中上传文件则要根据限制上传文件大小调整这个配置。比如100M，这个时候如果有10个人同时上传100M文件，则就会占用1G内存。如果要上传更大文件，则要考虑分割文件分多次请求上传。

如果上传文件占用内存太大可能会导致服务器被拖死，所以部分大型网站用专用服务器来处理大文件上传。

2、文件大小限制

HTTP协议1.1版本中消息体长度字段Content-Length的类型规定为16个字节的Decimal类型【它能表示的最大值大到没朋友】，且没有对该长度做逻辑上限制。但如果程序里用Int类型表示文件大小字节数，由于4个字节的int类型最大能表示的you有符号整数位为2GB-1，无符号整数最大值为4GB，会导致程序能上传的最大文件为2GB或4GB。

3、其它常见问题

- 大文件传输，应该支持断点续传；
- 要有文件校验，校验不对的话能自动重传；
- 要考虑多线程分片上传，并发控制，带宽压力，限速上传；
- 多文件排队上传；
- 中转临时文件的删除机制；